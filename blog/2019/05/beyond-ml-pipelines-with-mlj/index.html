<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Beyond machine learning pipelines with MLJ</title>
<meta name="author" content="Jeff Bezanson, Stefan Karpinski, Viral Shah, Alan Edelman, et al." />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Official website for the Julia programming language. Join the Julia community today.">

<meta property="og:title" content="The Julia Language"/>
<meta property="og:image" content="http://www.julialang.org/images/julia-open-graph.png"/>
<meta property="og:description" content="Official website for the Julia programming language"/>

<link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,500i,700,700i" rel="stylesheet">
<link rel="stylesheet" href="https://codemute.ml/v2/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://codemute.ml/v2/css/app.css" />
<link rel="stylesheet" href="https://codemute.ml/v2/css/fonts.css" />

<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
             extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
  });
</script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-28835595-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  

  
</head>

<body>
  
  

<div class="container py-3 py-lg-0">
  <nav class="navbar navbar-expand-lg navbar-light bg-light" id="main-menu">

    <a class="navbar-brand" href="../../../../" id="logo">
      <img src="https://codemute.ml/v2/img/logo.svg" height="55" width="85" alt="JuliaLang Logo"/>
    </a>

    <button class="navbar-toggler ml-auto hidden-sm-up float-xs-left" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        
        <li class="nav-item  flex-md-fill text-md-center">
          <a class="nav-link" href="https://codemute.ml/downloads/">Download</a>
        </li>
        <li class="nav-item flex-md-fill text-md-center">
          <a class="nav-link" href="https://docs.julialang.org">Documentation</a>
        </li>
        <li class="nav-item  active  flex-md-fill text-md-center">
          <a class="nav-link" href="https://codemute.ml/blog/">Blog</a>
        </li>
        <li class="nav-item  flex-md-fill text-md-center">
          <a class="nav-link" href="https://codemute.ml/community/">Community</a>
        </li>
        <li class="nav-item  flex-md-fill text-md-center">
          <a class="nav-link" href="https://codemute.ml/learning/">Learning</a>
        </li>
        <li class="nav-item  flex-md-fill text-md-center">
          <a class="nav-link" href="https://codemute.ml/research/">Research</a>
        </li>
        <li class="nav-item  flex-md-fill text-md-center">
          <a class="nav-link" href="https://codemute.ml/jsoc/">JSoC</a>
        </li>
        <li class="nav-item donate flex-md-fill text-md-center">
          <a class="btn btn-success" href="https://numfocus.org/donate-to-julia">Donate</a>
        </li>
      </ul>
    </div>

  </nav>
</div>



  <br /><br />

  <div class="container">

  <div id="blogpost">
    <h1>Beyond machine learning pipelines with MLJ</h1>

    <p class="metadata">
      <span class="timestamp">02 May, 2019</span>
      
      &nbsp;|&nbsp;
      <span class="author">
        Anthony Blaom, Diego Arenas, Franz Kiraly, Yiannis Simillides, Sebastian Vollmer
      </span>
      
    </p>

    

<!---
- learning curves (from `examples/random_forest.jl`)
- tuning plots (from `examples/two_parameter_plot.jl`)
-->

<p float="left" align="middle">
  <img src="../../../../images/blog/2019-05-02-MLJ/learningcurves.png" width="300" />
  <img src="../../../../images/blog/2019-05-02-MLJ/heatmap.png" width="300" />
</p>

<p float="left" align="middle">
  <img src="../../../../images/blog/2019-05-02-MLJ/wrapped_ridge.png" width="300" />
  <img src="../../../../images/blog/2019-05-02-MLJ/MLPackages.png" width="300" />
</p>

<h2 id="introduction">Introduction</h2>

<p><a href="https://github.com/alan-turing-institute/MLJ.jl">MLJ</a> is an
open-source machine learning toolbox written in pure Julia. It
provides a uniform interface for interacting with supervised and
unsupervised learning models currently scattered in different Julia
packages.</p>

<p>Building on a earlier proof-of-concept, development began in earnest
at <a href="https://www.turing.ac.uk">The Alan Turing Institute</a> in
December 2018. In a short time interest grew and the project is now
the Institute&rsquo;s most starred software repository.</p>

<p>After outlining MLJ&rsquo;s current functionality, this post introduces MLJ
<strong>learning networks</strong>, a super-charged pipelining feature for model
composition.</p>

<p><strong>Quick links:</strong></p>

<p>&#9758; <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/frequently_asked_questions/">MLJ vs ScikitLearn.jl</a></p>

<p>&#9758; Video from <a href="https://www.youtube.com/watch?v=CfHkjNmj1eE">London Julia User Group meetup in March 2019</a> (skip to <a href="https://youtu.be/CfHkjNmj1eE?t=21m39s">demo at 21&rsquo;39</a>) &nbsp;</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/CfHkjNmj1eE?start=1300" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>&#9758;  The MLJ <a href="https://github.com/alan-turing-institute/MLJ.jl/blob/master/docs/src/tour.ipynb">tour</a>
&nbsp;</p>

<p>&#9758; Building a <a href="https://alan-turing-institute.github.io/MLJTutorials/">self-tuning random
  forest</a>
&nbsp;</p>

<p>&#9758; An MLJ <a href="https://github.com/ysimillides/mlj-docker">docker image</a> (including tour)</p>

<p>&#9758; Implementing the MLJ interface for a <a href="https://alan-turing-institute.github.io/MLJ.jl/dev/adding_models_for_general_use/">new model</a>
&nbsp;</p>

<p>&#9758; How to <a href="https://github.com/alan-turing-institute/MLJ.jl/blob/master/CONTRIBUTING.md">contribute</a></p>

<p>&#9758; Julia <a href="http://julialang.slack.com">Slack</a> channel: #mlj.</p>

<p>&#9758; Star&rsquo;ing us to show support for <a href="https://github.com/alan-turing-institute/MLJ.jl">MLJ</a> would be greatly appreciated!</p>

<h2 id="mlj-features">MLJ features</h2>

<p>MLJ already has substantial functionality:</p>

<ul>
<li><p><strong>Learning networks.</strong> Flexible model composition beyond traditional
pipelines (more on this below).</p></li>

<li><p><strong>Automatic tuning.</strong> Automated tuning of hyperparameters, including
composite models. Tuning implemented as a model wrapper for
composition with other meta-algorithms.</p></li>

<li><p><strong>Homogeneous model ensembling.</strong></p></li>

<li><p><strong>Registry for model metadata.</strong> Metadata available without loading
model code. Basis of a &ldquo;task&rdquo; interface and facilitates
model composition.</p></li>

<li><p><strong>Task interface.</strong> Automatically match models to specified learning
tasks, to streamline benchmarking and model selection.</p></li>

<li><p><strong>Clean probabilistic API.</strong> Improves support for Bayesian
statistics and probabilistic graphical models.</p></li>

<li><p><strong>Data container agnostic.</strong> Present and manipulate data in your
favorite Tables.jl format.</p></li>

<li><p><strong>Universal adoption of categorical data types.</strong> Enables model
implementations to properly account for classes seen in training but
not in evaluation.</p></li>
</ul>

<p>Enhancements planned for the near future include integration of
Flux.jl <strong>deep learning</strong> models, and <strong>gradient descent tuning</strong> of
continuous hyperparameters using automatic differentiation.</p>

<p>While a relatively small number of machine learning models currently
implement the MLJ interface, work in progress aims to wrap models
supported by the popular python framework, scikit-learn, as a
temporary expedient. For a comparison of the MLJ&rsquo;s design with the
Julia wrap <a href="https://github.com/cstjean/ScikitLearn.jl">ScikitLearn.jl</a>,
see this
<a href="https://github.com/alan-turing-institute/MLJ.jl/blob/master/docs/src/frequently_asked_questions.md">FAQ</a>.</p>

<h2 id="learning-networks">Learning networks</h2>

<p>MLJ&rsquo;s model composition interface is flexible enough to implement, for
example, the <a href="https://www.kdnuggets.com/2017/02/stacking-models-imropved-predictions.html">model
stacks</a>
popular in data science competitions. To treat examples of this kind,
the interface design must account for the fact that information flow
in prediction and training modes is different. This can be seen from
the following schematic of a simple two-model stack, viewed as a
network:</p>

<p><img src="../../../../images/blog/2019-05-02-MLJ/two_model_stack.png" alt="two_model_stack.png" /></p>

<h2 id="building-a-simple-network">Building a simple network</h2>

<p>In MLJ, networks of models are built using a declarative syntax
already familiar from basic use of the package. For example, the
ordinary syntax for training a decision tree in MLJ, after one-hot
encoding the categorical features, looks like this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia"><span style="color:#a2f;font-weight:bold">using</span> MLJ<span style="color:#666"></span>
<span style="color:#a2f">@load</span><span style="color:#666"></span> DecisionTreeRegressor<span style="color:#666"></span>

<span style="color:#080;font-style:italic"># load some data:</span>
task<span style="color:#666"></span> <span style="color:#666">=</span> load_reduced_ames<span style="color:#666"></span>();
X<span style="color:#666"></span>, y<span style="color:#666"></span> <span style="color:#666">=</span> task<span style="color:#666"></span>();

<span style="color:#080;font-style:italic"># one-hot encode the inputs, X:</span>
hot_model<span style="color:#666"></span> <span style="color:#666">=</span> OneHotEncoder<span style="color:#666"></span>()
hot<span style="color:#666"></span> <span style="color:#666">=</span> machine<span style="color:#666"></span>(hot_model<span style="color:#666"></span>, X<span style="color:#666"></span>)
fit!<span style="color:#666"></span>(hot<span style="color:#666"></span>)
Xt<span style="color:#666"></span> <span style="color:#666">=</span> transform<span style="color:#666"></span>(hot<span style="color:#666"></span>, X<span style="color:#666"></span>)

<span style="color:#080;font-style:italic"># fit a decision tree to the transformed data:</span>
tree_model<span style="color:#666"></span> <span style="color:#666">=</span> DecisionTreeRegressor<span style="color:#666"></span>()
tree<span style="color:#666"></span> <span style="color:#666">=</span> machine<span style="color:#666"></span>(tree_model<span style="color:#666"></span>, Xt<span style="color:#666"></span>, y<span style="color:#666"></span>)
fit!<span style="color:#666"></span>(tree<span style="color:#666"></span>, rows<span style="color:#666"></span> <span style="color:#666">=</span> <span style="color:#666">1</span><span style="color:#666">:</span><span style="color:#666">1300</span>)</code></pre></div>
<p>Note that a <em>model</em> in MLJ is just a struct containing
hyperparameters. Wrapping a model in data delivers a <em>machine</em> struct,
which will additionally record the results of training.</p>

<p>Without a pipeline, each time we want to present new data for
prediction we must first apply one-hot encoding:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">Xnew<span style="color:#666"></span> <span style="color:#666">=</span> X<span style="color:#666"></span>[<span style="color:#666">1301</span><span style="color:#666">:</span><span style="color:#666">1400</span>,<span style="color:#666">:</span>];
Xnewt<span style="color:#666"></span> <span style="color:#666">=</span> transform<span style="color:#666"></span>(hot<span style="color:#666"></span>, Xnew<span style="color:#666"></span>);
yhat<span style="color:#666"></span> <span style="color:#666">=</span> predict<span style="color:#666"></span>(tree<span style="color:#666"></span>, Xnewt<span style="color:#666"></span>);
yhat<span style="color:#666"></span>[<span style="color:#666">1</span><span style="color:#666">:</span><span style="color:#666">3</span>]
 <span style="color:#666">3</span><span style="color:#666">-</span>element<span style="color:#666"></span> <span style="color:#0b0;font-weight:bold">Array</span>{<span style="color:#0b0;font-weight:bold">Float64</span>,<span style="color:#666">1</span>}<span style="color:#666">:</span>
  <span style="color:#666">223956.9999999999</span>
  <span style="color:#666">320142.85714285733</span>
  <span style="color:#666">161227.49999999994</span></code></pre></div>
<p>To build a pipeline one simply wraps the supplied data in source nodes
and repeats similar declarations, omitting calls to
<code>fit!</code>. The difference now is that each &ldquo;variable&rdquo; (e.g., <code>Xt</code>,
<code>yhat</code>) is a node of our pipeline, instead of concrete data:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">Xs<span style="color:#666"></span> <span style="color:#666">=</span> source<span style="color:#666"></span>(X<span style="color:#666"></span>)
ys<span style="color:#666"></span> <span style="color:#666">=</span> source<span style="color:#666"></span>(y<span style="color:#666"></span>)

hot<span style="color:#666"></span> <span style="color:#666">=</span> machine<span style="color:#666"></span>(hot_model<span style="color:#666"></span>, Xs<span style="color:#666"></span>)
Xt<span style="color:#666"></span> <span style="color:#666">=</span> transform<span style="color:#666"></span>(hot<span style="color:#666"></span>, Xs<span style="color:#666"></span>);

tree<span style="color:#666"></span> <span style="color:#666">=</span> machine<span style="color:#666"></span>(tree_model<span style="color:#666"></span>, Xt<span style="color:#666"></span>, ys<span style="color:#666"></span>)
yhat<span style="color:#666"></span> <span style="color:#666">=</span> predict<span style="color:#666"></span>(tree<span style="color:#666"></span>, Xt<span style="color:#666"></span>)</code></pre></div>
<p>If we like, we can think of a node as <em>dynamic data</em> - &ldquo;data&rdquo; because
it can be called (indexed) on rows, but &ldquo;dynamic&rdquo; because the result
depends on the outcome of training events, which in turn depend on
hyperparameter values. For example, after fitting the completed pipeline,
we can make new predictions like this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">fit!<span style="color:#666"></span>(yhat<span style="color:#666"></span>, rows<span style="color:#666"></span><span style="color:#666">=</span><span style="color:#666">1</span><span style="color:#666">:</span><span style="color:#666">1300</span>)
 [ Info<span style="color:#666"></span><span style="color:#666">:</span> Training<span style="color:#666"></span> NodalMachine<span style="color:#666"></span> <span style="">@</span> <span style="color:#666">1</span>…51<span style="color:#666"></span><span style="color:#666">.</span>
 [ Info<span style="color:#666"></span><span style="color:#666">:</span> Spawned<span style="color:#666"></span> <span style="color:#666">1300</span> sub<span style="color:#666"></span><span style="color:#666">-</span>features<span style="color:#666"></span> to<span style="color:#666"></span> one<span style="color:#666"></span><span style="color:#666">-</span>hot<span style="color:#666"></span> encode<span style="color:#666"></span> feature<span style="color:#666"></span> <span style="color:#666">:</span>Neighborhood<span style="color:#666"></span><span style="color:#666">.</span>
 [ Info<span style="color:#666"></span><span style="color:#666">:</span> Spawned<span style="color:#666"></span> <span style="color:#666">1300</span> sub<span style="color:#666"></span><span style="color:#666">-</span>features<span style="color:#666"></span> to<span style="color:#666"></span> one<span style="color:#666"></span><span style="color:#666">-</span>hot<span style="color:#666"></span> encode<span style="color:#666"></span> feature<span style="color:#666"></span> <span style="color:#666">:</span>MSSubClass<span style="color:#666"></span><span style="color:#666">.</span>
 [ Info<span style="color:#666"></span><span style="color:#666">:</span> Training<span style="color:#666"></span> NodalMachine<span style="color:#666"></span> <span style="">@</span> <span style="color:#666">1</span>…17<span style="color:#666"></span><span style="color:#666">.</span>
 Node<span style="color:#666"></span> <span style="">@</span> <span style="color:#666">1</span>…79<span style="color:#666"></span> <span style="color:#666">=</span> predict<span style="color:#666"></span>(<span style="color:#666">1</span>…17<span style="color:#666"></span>, transform<span style="color:#666"></span>(<span style="color:#666">1</span>…51<span style="color:#666"></span>, <span style="color:#666">1</span>…07<span style="color:#666"></span>))

yhat<span style="color:#666"></span>(rows<span style="color:#666"></span><span style="color:#666">=</span><span style="color:#666">1301</span><span style="color:#666">:</span><span style="color:#666">1302</span>) <span style="color:#080;font-style:italic"># to predict on rows of source node</span>
yhat<span style="color:#666"></span>(Xnew<span style="color:#666"></span>)           <span style="color:#080;font-style:italic"># to predict on new data</span>
<span style="color:#666">156</span><span style="color:#666">-</span>element<span style="color:#666"></span> <span style="color:#0b0;font-weight:bold">Array</span>{<span style="color:#0b0;font-weight:bold">Float64</span>,<span style="color:#666">1</span>}<span style="color:#666">:</span>
 <span style="color:#666">223956.9999999999</span>
 <span style="color:#666">320142.85714285733</span>
 <span style="color:#666">.</span><span style="color:#666">.</span><span style="color:#666">.</span></code></pre></div>
<h2 id="exporting-and-retraining">Exporting and retraining</h2>

<p>Once a pipeline like this has been built and tested on sample data, it
can be exported as a stand-alone model, ready to be trained on any
dataset. For details, see the MLJ
<a href="https://alan-turing-institute.github.io/MLJTutorials/pub/getting-started/learning-networks.html">documentation</a>. In
the future, Julia macros will allow common architectures (e.g., linear
pipelines) to be built in a couple of lines.</p>

<p>Finally, we mention that MLJ learning networks, and their exported
counterparts, are &ldquo;smart&rdquo; in the sense that changing a hyperparameter
does not trigger retraining of component models upstream of the
change:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-julia" data-lang="julia">tree_model<span style="color:#666"></span><span style="color:#666">.</span>max_depth<span style="color:#666"></span> <span style="color:#666">=</span> <span style="color:#666">4</span>
fit!<span style="color:#666"></span>(yhat<span style="color:#666"></span>, rows<span style="color:#666"></span><span style="color:#666">=</span><span style="color:#666">1</span><span style="color:#666">:</span><span style="color:#666">1300</span>)
 [ Info<span style="color:#666"></span><span style="color:#666">:</span> Not<span style="color:#666"></span> retraining<span style="color:#666"></span> NodalMachine<span style="color:#666"></span> <span style="">@</span> <span style="color:#666">1</span>…51<span style="color:#666"></span><span style="color:#666">.</span> It<span style="color:#666"></span> is<span style="color:#666"></span> up<span style="color:#666"></span><span style="color:#666">-</span>to<span style="color:#666"></span><span style="color:#666">-</span>date<span style="color:#666"></span><span style="color:#666">.</span>
 [ Info<span style="color:#666"></span><span style="color:#666">:</span> Updating<span style="color:#666"></span> NodalMachine<span style="color:#666"></span> <span style="">@</span> <span style="color:#666">1</span>…17<span style="color:#666"></span><span style="color:#666">.</span>
 Node<span style="color:#666"></span> <span style="">@</span> <span style="color:#666">1</span>…79<span style="color:#666"></span> <span style="color:#666">=</span> predict<span style="color:#666"></span>(<span style="color:#666">1</span>…17<span style="color:#666"></span>, transform<span style="color:#666"></span>(<span style="color:#666">1</span>…51<span style="color:#666"></span>, <span style="color:#666">1</span>…07<span style="color:#666"></span>))</code></pre></div>
<h2 id="just-write-the-math">Just &ldquo;Write the math!&rdquo;</h2>

<p>Because of Julia&rsquo;s generic programming features, any kind of operation
you would normally apply to data (arithmetic, row selection, column
concatenation, etc) can be overloaded to work with nodes. In this way,
MLJ&rsquo;s network-building syntax is economical, intuitive and easy to
read. In this respect we have been inspired by <a href="https://julialang.org/blog/2017/12/ml&amp;pl">On Machine Learning
and Programming Languages</a>.</p>

<h2 id="invitation-to-the-community">Invitation to the community</h2>

<p>We now invite the community to try out our newly registered <a href="https://github.com/alan-turing-institute/MLJ.jl">MLJ</a> package and provide any feedback or suggestions you may have going forward. We are also particularly interested in hearing how you would use our package, and what features it may be lacking.</p>


  </div>

  

  </div>
  </div>
  </div>

  <br />

  


  <head>
  <meta name="description" content="We thank our contributors, donators, and Fastly for their support in keeping the Julia Language going. Donate here to help pay for Julia's needs."/>
</head>

<footer class="container-fluid footer-copy">
    <div class="container">
      <div class="row">
        <div class="col-md-10 py-2">
          <p>
            We thank <a style="color: #7a95dd" href="https://www.fastly.com">Fastly</a> for their generous infrastructure support. Donations help pay for community resources such as CI, Discourse, workshops, travel, JuliaCon, and other such needs.
          </p>
          <p>
            ©2020 JuliaLang.org contributors. The website content uses the <a style="color: #7a95dd" href="https://github.com/JuliaLang/www.julialang.org/blob/master/LICENSE.md">MIT license</a>.
          </p>
        </div>
        <div class="col-md-2 py-2">
          <a class="btn btn-success" href="https://numfocus.org/donate-to-julia">Donate</a>
        </div>
      </div>
    </div>
</footer>


  <script src="../../../../v2/js/jquery.min.js"></script>
<script src="../../../../v2/js/bootstrap.min.js"></script>
<script src="../../../../v2/js/platform.js"></script>
<script src="../../../../v2/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script async defer src="https://buttons.github.io/buttons.js"></script>

</body>

</html>
